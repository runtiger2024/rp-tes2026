<div id="create-shipment-modal" class="modal-overlay" style="display: none">
  <div class="modal-content modal-lg checkout-modal animate-pop-in">
    <button class="modal-close" onclick="window.modalManager.close()">
      &times;
    </button>

    <div
      class="modal-header"
      style="
        border-bottom: 2px solid #f1f5f9;
        margin-bottom: 20px;
        padding-bottom: 15px;
      "
    >
      <h3
        style="
          margin: 0;
          color: #1e293b;
          font-weight: 800;
          display: flex;
          align-items: center;
        "
      >
        <i class="fas fa-boxes" style="color: #1a73e8; margin-right: 12px"></i
        >ç¢ºèªè¨‚å–® (åˆä½µæ‰“åŒ…)
      </h3>
    </div>

    <form id="create-shipment-form">
      <div
        class="checkout-layout"
        style="display: grid; grid-template-columns: 1.2fr 1fr; gap: 25px"
      >
        <div class="checkout-items-section">
          <h4
            style="
              margin: 0 0 15px 0;
              font-size: 16px;
              color: #334155;
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            ğŸ“¦ å¾…æ‰“åŒ…åŒ…è£¹å…§å®¹
            <span style="font-size: 13px; color: #64748b; font-weight: normal"
              >å·²é¸
              <span
                id="checkout-total-count"
                style="color: #1a73e8; font-weight: 700"
                >0</span
              >
              ä»¶</span
            >
          </h4>

          <div
            id="shipment-package-list"
            class="custom-scrollbar"
            style="
              max-height: 280px;
              overflow-y: auto;
              margin-bottom: 20px;
              border: 1.5px solid #e2e8f0;
              border-radius: 12px;
              background: #f8fafc;
              padding: 10px;
            "
          ></div>

          <div
            class="cost-calculation-box"
            style="
              background: #fff;
              border: 1.5px solid #e2e8f0;
              border-radius: 16px;
              padding: 20px;
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
                font-size: 14px;
                color: #64748b;
              "
            >
              <span>é ä¼°ç¸½é‡é‡ï¼š</span>
              <span
                id="checkout-total-weight"
                style="color: #1e293b; font-weight: 700"
                >0.00 kg</span
              >
            </div>
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-bottom: 15px;
                font-size: 14px;
                color: #64748b;
              "
            >
              <span>é ä¼°åŸºæœ¬é‹è²»ï¼š</span>
              <span
                id="checkout-base-fee"
                style="color: #1e293b; font-weight: 700"
                >NT$ 0</span
              >
            </div>
            <div
              style="
                border-top: 1px dashed #cbd5e1;
                padding-top: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <span style="font-weight: 800; color: #1e293b">æ‡‰ä»˜ç¸½é‡‘é¡ï¼š</span>
              <span
                id="checkout-final-total"
                style="font-size: 24px; font-weight: 900; color: #d32f2f"
                >NT$ 0</span
              >
            </div>
          </div>
        </div>

        <div class="checkout-shipping-section">
          <div
            style="
              background: #fff;
              border: 1.5px solid #e2e8f0;
              border-radius: 16px;
              padding: 20px;
              margin-bottom: 20px;
            "
          >
            <h4 style="margin: 0 0 15px 0; font-size: 15px; color: #334155">
              <i class="fas fa-truck" style="color: #1a73e8"></i> é…é€è³‡è¨Š
            </h4>

            <button
              type="button"
              class="btn-select-address"
              onclick="window.modalManager.open('recipient-selector')"
              style="
                width: 100%;
                padding: 10px;
                margin-bottom: 15px;
                border-radius: 10px;
                border: 1px dashed #1a73e8;
                background: #eff6ff;
                color: #1a73e8;
                font-weight: 700;
                cursor: pointer;
              "
            >
              å¾å¸¸ç”¨æ”¶ä»¶äººé¸æ“‡
            </button>

            <div class="form-group" style="margin-bottom: 12px">
              <input
                type="text"
                id="ship-name"
                class="form-control"
                placeholder="æ”¶ä»¶äººå§“å"
                required
                style="
                  width: 100%;
                  padding: 12px;
                  border-radius: 10px;
                  border: 1.5px solid #e2e8f0;
                "
              />
            </div>
            <div class="form-group" style="margin-bottom: 12px">
              <input
                type="tel"
                id="ship-phone"
                class="form-control"
                placeholder="è¯ç¹«é›»è©±"
                required
                style="
                  width: 100%;
                  padding: 12px;
                  border-radius: 10px;
                  border: 1.5px solid #e2e8f0;
                "
              />
            </div>
            <div class="form-group">
              <textarea
                id="ship-address"
                class="form-control"
                placeholder="å°ç£å®Œæ•´æ”¶ä»¶åœ°å€"
                required
                style="
                  width: 100%;
                  padding: 12px;
                  border-radius: 10px;
                  border: 1.5px solid #e2e8f0;
                  height: 80px;
                  resize: none;
                "
              ></textarea>
            </div>
          </div>

          <div
            style="
              background: #fdf2f2;
              border: 1px solid #fecaca;
              border-radius: 16px;
              padding: 15px;
            "
          >
            <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #991b1b">
              <i class="fas fa-credit-card"></i> æ”¯ä»˜èˆ‡ç™¼ç¥¨
            </h4>
            <div
              id="wallet-pay-info"
              style="
                font-size: 13px;
                color: #b91c1c;
                margin-bottom: 10px;
                background: #fff;
                padding: 8px;
                border-radius: 8px;
              "
            >
              æ­£åœ¨æª¢æŸ¥å¸³è™Ÿé¤˜é¡ç‹€æ…‹...
            </div>
            <div style="font-size: 11px; color: #666; line-height: 1.5">
              <i class="fas fa-info-circle"></i>
              ç³»çµ±å°‡è‡ªå‹•é–‹ç«‹é›»å­ç™¼ç¥¨ã€‚è‹¥éœ€çµ±ç·¨ï¼Œè«‹æ–¼ä»˜æ¬¾æ†‘è­‰ä¸Šå‚³æ™‚å¡«å¯«ã€‚
            </div>
          </div>
        </div>
      </div>

      <div
        class="modal-footer sticky-footer-actions"
        style="
          margin-top: 25px;
          display: flex;
          gap: 15px;
          padding-top: 20px;
          border-top: 1px solid #f1f5f9;
        "
      >
        <button
          type="button"
          class="btn btn-secondary"
          onclick="window.modalManager.close()"
          style="
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            font-weight: 700;
            background: #f8fafc;
            border: 1.5px solid #e2e8f0;
          "
        >
          å–æ¶ˆé‡é¸
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          style="
            flex: 2;
            padding: 15px;
            border-radius: 12px;
            font-weight: 800;
            background: #1a73e8;
            color: #fff;
            border: none;
            font-size: 17px;
            box-shadow: 0 8px 20px rgba(26, 115, 232, 0.3);
          "
        >
          <i class="fas fa-check-circle"></i> æ­£å¼æäº¤é›†é‹è¨‚å–®
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  /* æ·±åº¦é‚„åŸï¼šåŒ…è£¹å¡ç‰‡å¾®ç¸®æ¨£å¼ */
  .checkout-package-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    margin-bottom: 8px;
    font-size: 13px;
  }
  .checkout-package-item .pkg-tracking {
    font-family: monospace;
    font-weight: 700;
    color: #1e293b;
  }
  .checkout-package-item .pkg-weight {
    color: #1a73e8;
    font-weight: 600;
  }

  /* è‡ªå®šç¾©æ»¾å‹•æ¢ */
  .custom-scrollbar::-webkit-scrollbar {
    width: 5px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 10px;
  }
</style>

<script>
  /**
   * æ·±åº¦é‚„åŸï¼šè¡¨å–®æäº¤å°æ¥é‚è¼¯
   * æ­¤è™•æœƒå°‡é›†é‹æ•¸æ“šå‚³é€åˆ° shipment-flow.js é€²è¡Œè™•ç†
   */
  document
    .getElementById("create-shipment-form")
    .addEventListener("submit", async function (e) {
      e.preventDefault();
      if (window.shipmentFlow && window.shipmentFlow.submitShipment) {
        await window.shipmentFlow.submitShipment();
      }
    });
</script>
