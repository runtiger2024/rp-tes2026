<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>小跑豬傢俱海運試算 | 專業集運專線</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />

    <link rel="stylesheet" href="css/theme-client.css" />
    <link rel="stylesheet" href="css/client-index.css" />
    <link rel="stylesheet" href="css/modals-unified.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script src="js/styleLoader.js"></script>
  </head>

  <body class="index-theme">
    <div id="announcement-bar" class="announcement-bar"></div>

    <div class="page-container">
      <section class="hero-section">
        <nav class="top-nav">
          <img src="assets/logo.png" alt="Logo" class="nav-logo" />
          <div class="nav-auth-btns">
            <a href="login.html" class="btn-login-outline">登入 / 註冊</a>
          </div>
        </nav>
        <div class="hero-text-content">
          <h1 class="animate-fade-in">專業傢俱海運試算</h1>
          <p class="animate-fade-in" style="animation-delay: 0.1s">
            透明費率，一鍵精算，無任何隱藏費用
          </p>
        </div>
      </section>

      <div class="calculator-container animate-slide-up">
        <div class="card calc-card">
          <div class="card-header">
            <i class="fas fa-calculator"></i> 運費即時估價
          </div>
          <div class="card-body">
            <form id="quote-form">
              <div class="form-row">
                <div class="form-group">
                  <label>貨物重量 (kg)</label>
                  <input
                    type="number"
                    id="input-weight"
                    placeholder="0.0"
                    step="0.1"
                    required
                  />
                </div>
              </div>
              <div class="form-row-3">
                <div class="form-group">
                  <label>長 (cm)</label>
                  <input
                    type="number"
                    id="input-length"
                    placeholder="長"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>寬 (cm)</label>
                  <input
                    type="number"
                    id="input-width"
                    placeholder="寬"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>高 (cm)</label>
                  <input
                    type="number"
                    id="input-height"
                    placeholder="高"
                    required
                  />
                </div>
              </div>
              <button type="submit" class="btn-calculate" id="btn-submit-quote">
                <span>開始計算</span> <i class="fas fa-arrow-right"></i>
              </button>
            </form>
          </div>
        </div>

        <div
          id="results-container"
          class="results-grid"
          style="display: none"
        ></div>

        <div id="loading-spinner" class="loading-overlay" style="display: none">
          <div class="spinner-apple"></div>
          <p>正在同步全球最新費率...</p>
        </div>
      </div>

      <footer class="site-footer">
        <div class="site-footer__container">
          <p>© 2026 小跑豬物流系統｜專業家具海運專線</p>
          <div class="footer-links">
            <a href="admin-login.html" class="text-sub">管理端入口</a>
          </div>
        </div>
      </footer>
    </div>

    <nav id="mobile-bottom-nav" class="universal-bottom-nav"></nav>

    <script src="js/apiConfig.js"></script>
    <script type="module">
      import { apiClient } from "./assets/js/api/apiClient.js";
      import { layoutEngine } from "./assets/js/core/layout-engine.js";

      document.addEventListener("DOMContentLoaded", async () => {
        // 1. 加載 UI 組件
        await layoutEngine.loadCommonComponents();

        // 2. 處理試算邏輯
        const quoteForm = document.getElementById("quote-form");
        quoteForm.onsubmit = async (e) => {
          e.preventDefault();
          const loader = document.getElementById("loading-spinner");
          loader.style.display = "flex";

          try {
            const payload = {
              weight: document.getElementById("input-weight").value,
              length: document.getElementById("input-length").value,
              width: document.getElementById("input-width").value,
              height: document.getElementById("input-height").value,
            };
            const data = await apiClient.post(
              "/client/pricing/estimate",
              payload
            );
            renderResults(data); // 這裡對接您原本的結果渲染函數
          } catch (err) {
            alert(err.message);
          } finally {
            loader.style.display = "none";
          }
        };
      });

      function renderResults(data) {
        const container = document.getElementById("results-container");
        container.innerHTML = `
          <div class="result-card animate-pop-in">
            <div class="res-label">預估才數</div>
            <div class="res-value">${data.volumeCai} 才</div>
          </div>
          <div class="result-card animate-pop-in highlight">
            <div class="res-label">總計運費 (TWD)</div>
            <div class="res-value">NT$ ${data.totalFee.toLocaleString()}</div>
          </div>
        `;
        container.style.display = "grid";
      }
    </script>
  </body>
</html>
